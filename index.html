<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CollabCloud</title>
  <style>
    :root {
      --primary: #0078d4;
      --bg-light: #f0f2f5;
      --bg-dark: #1e1e1e;
      --text-light: #ffffff;
      --text-dark: #000000;
      --message-light: #eef6ff;
      --message-dark: #2c2c2c;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }

    body {
      background-color: var(--bg-light);
      color: var(--text-dark);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    body.dark {
      background-color: var(--bg-dark);
      color: var(--text-light);
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: var(--primary);
      padding: 10px 20px;
      color: white;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo img {
      height: 40px;
    }

    .profile-area {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .profile-area img {
      height: 40px;
      width: 40px;
      border-radius: 50%;
      object-fit: cover;
      cursor: pointer;
      border: 2px solid white;
    }

    .dark-toggle {
      cursor: pointer;
      font-size: 20px;
      background: white;
      border-radius: 50%;
      padding: 6px;
      color: var(--primary);
      transition: transform 0.3s;
    }

    .dark-toggle:hover {
      transform: rotate(180deg);
    }

    main {
      padding: 20px;
    }

    .message-container {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 800px;
      margin: 0 auto;
    }

    body.dark .message-container {
      background-color: #2b2b2b;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button {
      background-color: var(--primary);
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .message-item {
      background-color: var(--message-light);
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      position: relative;
    }

    body.dark .message-item {
      background-color: var(--message-dark);
    }

    .edit-btn, .delete-btn {
      position: absolute;
      top: 10px;
      background: #ccc;
      color: black;
      padding: 5px;
      font-size: 12px;
      border: none;
      cursor: pointer;
    }

    .edit-btn { right: 70px; }
    .delete-btn { right: 10px; }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <img src="logo.png" alt="Logo" />
      <h1>CollabCloud</h1>
    </div>
    <div class="profile-area">
      <span id="usernameDisplay">Anonymous</span>
      <img id="profilePic" src="https://via.placeholder.com/40" alt="Profile" onclick="document.getElementById('fileInput').click();" />
      <input type="file" id="fileInput" style="display:none" accept="image/*" onchange="uploadProfilePic(event)" />
      <div class="dark-toggle" onclick="toggleDarkMode()">ðŸŒ“</div>
    </div>
  </header>

  <main>
    <div class="message-container">
      <input type="text" id="topicInput" placeholder="Enter Topic" />
      <textarea id="textInput" placeholder="Enter Message"></textarea>
      <button onclick="addMessage()">Post Message</button>
      <div id="messageList"></div>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded, update, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA_OT62IGPCaueoFN7yQP1EmeR1Yem4FW8",
      authDomain: "collabcloud-f0ed5.firebaseapp.com",
      databaseURL: "https://collabcloud-f0ed5-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "collabcloud-f0ed5",
      storageBucket: "collabcloud-f0ed5.appspot.com",
      messagingSenderId: "490023921099",
      appId: "1:490023921099:web:YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const messagesRef = ref(db, "messages");

    // Load saved username and profile picture
    window.onload = () => {
      const username = localStorage.getItem("username") || "Anonymous";
      document.getElementById("usernameDisplay").innerText = username;

      const pic = localStorage.getItem("profilePic");
      if (pic) document.getElementById("profilePic").src = pic;

      if (localStorage.getItem("darkMode") === "enabled") {
        document.body.classList.add("dark");
      }
    };

    // Upload profile picture
    window.uploadProfilePic = (e) => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function(evt) {
        const img = evt.target.result;
        document.getElementById("profilePic").src = img;
        localStorage.setItem("profilePic", img);
      };
      reader.readAsDataURL(file);
    };

    // Toggle dark mode
    window.toggleDarkMode = () => {
      document.body.classList.toggle("dark");
      localStorage.setItem("darkMode", document.body.classList.contains("dark") ? "enabled" : "disabled");
    };

    // Add new message
    window.addMessage = () => {
      const topic = document.getElementById("topicInput").value.trim();
      const text = document.getElementById("textInput").value.trim();
      const username = localStorage.getItem("username") || "Anonymous";

      if (!topic || !text) return alert("Fill in both fields.");

      push(messagesRef, {
        topic,
        text,
        username,
        timestamp: Date.now()
      });

      document.getElementById("topicInput").value = "";
      document.getElementById("textInput").value = "";
    };

    // Display messages
    onChildAdded(messagesRef, (data) => {
      const msg = data.val();
      const key = data.key;

      const wrapper = document.createElement("div");
      wrapper.className = "message-item";
      wrapper.innerHTML = `
        <strong>${msg.topic}</strong> by ${msg.username}<br>
        <span id="text-${key}">${msg.text}</span>
        ${msg.username === (localStorage.getItem("username") || "Anonymous") ? `
          <button class="edit-btn" onclick="editMessage('${key}', '${msg.text.replace(/'/g, "\\'")}')">Edit</button>
          <button class="delete-btn" onclick="deleteMessage('${key}')">Delete</button>
        ` : ""}
      `;
      document.getElementById("messageList").appendChild(wrapper);
    });

    // Edit message
    window.editMessage = (key, currentText) => {
      const newText = prompt("Edit your message:", currentText);
      if (newText !== null) {
        update(ref(db, `messages/${key}`), { text: newText });
        document.getElementById(`text-${key}`).innerText = newText;
      }
    };

    // Delete message
    window.deleteMessage = (key) => {
      if (confirm("Are you sure you want to delete this message?")) {
        remove(ref(db, `messages/${key}`));
        location.reload(); // optional: clean refresh
      }
    };
  </script>
</body>
</html>
